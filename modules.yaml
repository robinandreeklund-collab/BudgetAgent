modules:
  import_bank_data:
    description: Läser in bankutdrag från olika format (CSV, Excel, JSON)
    functions:
      - name: load_file
        input: path: str
        output: DataFrame
        description: Läser in filen och returnerar rådata
      - name: detect_format
        input: data: DataFrame
        output: str
        description: Identifierar bankformat (Swedbank, SEB, Revolut etc.)
      - name: normalize_columns
        input: data: DataFrame, format: str
        output: DataFrame
        description: Standardiserar kolumnnamn till date, amount, description, currency
    yaml: settings_panel.yaml → import_format

  parse_transactions:
    description: Extraherar och strukturerar transaktioner från rådata
    functions:
      - name: parse_dates
        input: data: DataFrame
        output: DataFrame
        description: Konverterar datum till ISO-format
      - name: clean_descriptions
        input: data: DataFrame
        output: DataFrame
        description: Tar bort onödig text, symboler, bankkoder
      - name: extract_metadata
        input: data: DataFrame
        output: DataFrame
        description: Identifierar butik, kategori, plats via regex/heuristik

  categorize_expenses:
    description: Kategoriserar transaktioner automatiskt eller manuellt
    functions:
      - name: auto_categorize
        input: data: DataFrame, rules: dict
        output: DataFrame
        description: Matchar mot nyckelord i beskrivning
      - name: manual_override
        input: data: DataFrame, overrides: dict
        output: DataFrame
        description: Tillåter användaren att justera kategorier
      - name: update_category_map
        input: new_rules: dict
        output: None
        description: Uppdaterar YAML-regler för framtida matchning
    yaml: categorization_rules.yaml

  upcoming_bills:
    description: Hanterar framtida fakturor med belopp, förfallodatum och kategori
    functions:
      - name: add_bill
        input: name, amount, due_date, category
        output: None
        description: Lägger till ny faktura i YAML
      - name: get_upcoming_bills
        input: month: str
        output: List[dict]
        description: Returnerar alla fakturor för vald månad
      - name: validate_bill_format
        input: bill: dict
        output: bool
        description: Säkerställer korrekt struktur
    yaml: upcoming_bills.yaml

  income_tracker:
    description: Registrerar inkomster per person, både återkommande och engångs
    functions:
      - name: add_income
        input: person, source, amount, date, recurring
        output: None
        description: Sparar inkomst i YAML
      - name: get_monthly_income
        input: person, month
        output: float
        description: Summerar inkomster för vald månad
      - name: forecast_income
        input: months: int
        output: dict
        description: Skapar framtida inkomstprognos
    yaml: income_tracker.yaml

  net_balance_splitter:
    description: Fördelar kvarvarande pengar efter utgifter enligt valda regler
    functions:
      - name: split_balance
        input: total_income: dict, total_expenses: dict, rule: str
        output: dict
        description: Returnerar fördelning per person
      - name: apply_custom_ratio
        input: ratio: dict
        output: None
        description: T.ex. 60/40 mellan Robin och Partner
      - name: calculate_shared_vs_individual
        input: expenses: DataFrame
        output: dict
        description: Separerar gemensamma och individuella utgifter
    yaml: net_balance_splitter.yaml

  forecast_engine:
    description: Simulerar framtida saldo baserat på historik + planerade inkomster/fakturor
    functions:
      - name: calculate_historical_average
        input: data: DataFrame, window: int
        output: dict
        description: Genomsnitt per kategori
      - name: inject_future_income_and_bills
        input: income: list, bills: list
        output: dict
        description: Skapar framtida kassaflöde
      - name: simulate_monthly_balance
        input: months: int
        output: DataFrame
        description: Returnerar saldo per månad
      - name: compare_scenarios
        input: scenarios: list
        output: dict
        description: T.ex. “Vad händer om vi får 5000 kr extra i januari?”
    yaml: forecast_engine.yaml

  alerts_and_insights:
    description: Genererar varningar och insikter baserat på regler och forecast
    functions:
      - name: check_budget_thresholds
        input: data: DataFrame, thresholds: dict
        output: List[str]
        description: T.ex. “Matkostnad över 4000 kr!”
      - name: generate_insights
        input: data: DataFrame
        output: List[str]
        description: T.ex. “Du spenderar 20% mer på nöje än genomsnittet”
      - name: recommend_actions
        input: insight: str
        output: str
        description: T.ex. “Överväg att minska streamingkostnader”
    yaml: settings_panel.yaml → alert_threshold

  dashboard_ui:
    description: Dash-gränssnitt för visualisering, inmatning och agentinteraktion
    functions:
      - name: render_dashboard
        input: None
        output: None
        description: Startar Dash-app med alla komponenter
      - name: update_forecast_graph
        input: data: DataFrame
        output: None
        description: Visar framtida saldo
      - name: input_panel
        input: None
        output: Dash layout
        description: Formulär för inkomster, fakturor, inställningar
      - name: agent_query_interface
        input: None
        output: Dash layout
        description: Frågefält för t.ex. “Hur mycket har vi kvar i januari?”
    yaml: settings_panel.yaml, forecast_engine.yaml, income_tracker.yaml

  settings_panel:
    description: Hanterar alla inställningar via sliders, dropdowns, toggles
    functions:
      - name: load_settings
        input: yaml_path: str
        output: dict
        description: Läser in alla inställningar
      - name: render_controls
        input: settings: dict
        output: Dash layout
        description: Skapar Dash-komponenter
      - name: update_settings
        input: new_values: dict
        output: None
        description: Sparar ändringar till YAML
    yaml: settings_panel.yaml
